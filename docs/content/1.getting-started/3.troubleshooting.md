---
title: "Troubleshooting Nuxt Skew Protection"
description: Common issues and debugging tips for Nuxt Skew Protection.
navigation:
  title: "Troubleshooting"
---

## Common Issues

### Update Notifications Not Showing

**Problem:** Users aren't seeing update notifications after deploying a new version.

**Solutions:**

1. **Check your update strategy:**
   - Ensure the strategy matches your platform (see
     [Update Strategies](/docs/skew-protection/guides/update-strategies))
   - Verify SSE/WebSocket endpoints are accessible if using real-time
     strategies

2. **Verify the component is added:**

   ```vue
   <template>
     <SkewNotification>
       <!-- Your notification UI -->
     </SkewNotification>
   </template>
   ```

3. **Check browser console** for errors:
   - Service worker registration failures
   - Network errors connecting to update endpoints

4. **Intelligent notifications:** Remember that notifications only show when
   the user's **loaded modules** are invalidated. If the new deployment
   doesn't delete any chunks the user has loaded, no notification will appear.

### Build Assets Returning 404

**Problem:** Old sessions or crawlers getting 404 errors for `_nuxt/*.js` files.

**Solutions:**

1. **Verify storage configuration:**

   ```ts
   // Make sure storage is configured and persists between deployments
   export default defineNuxtConfig({
     skewProtection: {
       storage: {
         driver: 'fs', // or 's3', 'redis', etc.
         base: 'node_modules/.cache/nuxt/skew-protection'
       }
     }
   })
   ```

2. **Check retention settings:**

   ```ts
   export default defineNuxtConfig({
     skewProtection: {
       retentionDays: 30, // Assets older than this are cleaned up
       maxNumberOfVersions: 10 // Maximum versions to keep
     }
   })
   ```

3. **Platform-specific issues:**
   - **Vercel/Netlify:** Ensure storage is configured to persist (use Vercel KV, not filesystem)
   - **Cloudflare:** Use Cloudflare KV or R2, not filesystem

### Service Worker Issues

**Problem:** Service worker not tracking modules or detecting invalidations.

**Solutions:**

1. **Check service worker registration:**

   ```js
   // Browser console
   navigator.serviceWorker.getRegistrations().then(console.log)
   ```

2. **Verify `/sw.js` is accessible:**
   - Visit `http://localhost:3000/sw.js` - should return the service worker code
   - Check for CORS or CSP issues blocking registration

3. **Clear existing service workers:**

   ```js
   // Browser console
   navigator.serviceWorker.getRegistrations().then(regs =>
     regs.forEach(reg => reg.unregister())
   )
   ```

### WebSocket Strategy Not Working

**Problem:** WebSocket connections failing on Cloudflare.

**Solutions:**

1. **Ensure Durable Objects preset:**

   ```ts
   export default defineNuxtConfig({
     nitro: {
       preset: 'cloudflare-durable',
       experimental: {
         websockets: true
       }
     }
   })
   ```

2. **Check Wrangler configuration:**

   ```toml [wrangler.toml]
   compatibility_flags = [ "nodejs_compat" ]
   ```

3. **Verify WebSocket endpoint:** Visit `/_skew/ws` and check for upgrade errors

### SSE Strategy Not Working

**Problem:** Server-Sent Events not connecting.

**Solutions:**

1. **Platform compatibility:** SSE only works on Node.js/Bun/Deno, not Cloudflare Workers
   - For Cloudflare, use `checkForUpdateStrategy: 'ws'`
   - For static hosting, use `checkForUpdateStrategy: 'polling'`

2. **Check connection in DevTools:**
   - Network tab → Filter by `sse`
   - Should show a persistent connection to `/_skew/sse`

3. **Firewall/proxy issues:** Some firewalls block SSE connections

## Debugging

### Enable Debug Mode

Enable detailed logging to understand what's happening:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  skewProtection: {
    debug: true
  }
})
```

This will log:

- Version changes detected
- Asset management operations
- Module invalidation checks
- Update strategy events

### Check Build Metadata

Inspect the build metadata to verify version tracking:

```bash
# In your .output directory
cat .output/public/builds/latest.json
```

Should show:

```json
{
  "id": "abc123",
  "timestamp": 1234567890,
  "skewProtection": {
    "versions": {
      "abc123": {
        "timestamp": "...",
        "assets": ["..."],
        "deletedChunks": ["..."]
      }
    }
  }
}
```

### Inspect Storage

Check what's stored in your version storage:

::code-group

```bash [Filesystem]
# List stored versions
ls -la node_modules/.cache/nuxt/skew-protection/

# View manifest
cat node_modules/.cache/nuxt/skew-protection/version-manifest.json
```

```bash [Redis]
# List keys
redis-cli KEYS "skew-protection:*"

# View manifest
redis-cli GET "skew-protection:version-manifest"
```

::

### Browser DevTools

1. **Check service worker state:**
   - Application tab → Service Workers
   - Should show `/sw.js` as active

2. **Monitor update checks:**
   - Console tab → Filter by "skew"
   - Watch for version update logs

3. **Test manual update check:**

   ```js
   // Browser console
   const { checkForUpdates } = useSkewProtection()
   await checkForUpdates()
   ```

## Submitting an Issue

When submitting an issue, provide:

1. **Environment details:**
   - Platform (Vercel, Cloudflare, Node.js, etc.)
   - Update strategy (polling, SSE, WebSocket)
   - Storage driver

2. **Configuration:**

   ```ts
   // Your nuxt.config.ts skewProtection settings
   ```

3. **Console errors:** Screenshots or text of any errors

4. **Build metadata:** Content of `builds/latest.json`

5. **Minimal reproduction:** Create a reproduction on [StackBlitz](https://nuxt.new)

Submit issues at: <https://github.com/harlan-zw/nuxt-skew-protection/issues>
