---
title: Configuration
description: Complete configuration reference for Nuxt Skew Protection.
---

Complete configuration options for `nuxt.config.ts`.

## Basic Configuration

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  modules: ['nuxt-skew-protection'],

  skewProtection: {
    // Your configuration here
  }
})
```

## Options

### `enabled`

- Type: `boolean | undefined`
- Default: `true` (module is enabled unless explicitly set to `false`)

Enable or disable the module.

```ts
skewProtection: {
  enabled: process.env.NODE_ENV === 'production'
}
```

### `storage`

- Type: `StorageOptions`
- Required for production

Storage configuration for version assets and metadata.

```ts
export default defineNuxtConfig({
  skewProtection: {
    storage: {
      driver: 'fs', // or 'redis', 's3', 'cloudflare-kv-binding', etc.
      // Driver-specific options
    }
  }
})
```

See [Storage Configuration](/docs/skew-protection/guides/storage-configuration) for all drivers.

### `checkForUpdateStrategy`

- Type: `'polling' | 'sse' | 'ws'`
- Default: Auto-detected based on platform

Update detection strategy.

```ts
skewProtection: {
  checkForUpdateStrategy: 'sse'
}
```

**Auto-detection:**

- Static sites → `'polling'`
- Cloudflare Durable → `'ws'`
- Node.js/Bun/Deno → `'sse'`

See [Update Strategies](/docs/skew-protection/guides/update-strategies) for details.

### `retentionDays`

- Type: `number`
- Default: `30`

How many days to keep old versions before cleanup.

```ts
skewProtection: {
  retentionDays: 7 // Keep versions for 7 days
}
```

### `maxNumberOfVersions`

- Type: `number`
- Default: `10`

Maximum number of versions to retain.

```ts
skewProtection: {
  maxNumberOfVersions: 5 // Keep max 5 versions
}
```

Cleanup happens during build. Oldest versions are removed first.

### `cookie.name`

- Type: `string`
- Default: `'__nkpv'`

Cookie name for version tracking (configured via the `cookie` object).

```ts
skewProtection: {
  cookie: {
    name: '__app_version'
  }
}
```

### `cookie`

- Type: `CookieOptions`
- Default: See below

Cookie options.

```ts
export default defineNuxtConfig({
  skewProtection: {
    cookie: {
      path: '/',
      sameSite: 'strict' as const,
      secure: true,
      maxAge: 60 * 60 * 24 * 60, // 60 days
      domain: '.example.com' // Optional: share across subdomains
    }
  }
})
```

**CookieOptions:**

```ts
interface CookieOptions {
  path?: string
  domain?: string
  maxAge?: number
  expires?: Date
  httpOnly?: boolean // Must be false for client access
  secure?: boolean
  sameSite?: 'lax' | 'strict' | 'none'
}
```

### `debug`

- Type: `boolean`
- Default: `false`

Enable debug logging.

```ts
skewProtection: {
  debug: true
}
```

Logs:

- Version changes
- Asset operations
- Module invalidations
- Storage operations

## Complete Example

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  modules: ['nuxt-skew-protection'],

  skewProtection: {
    // Enable only in production
    enabled: process.env.NODE_ENV === 'production',

    // Storage configuration
    storage: {
      driver: 'redis',
      host: process.env.REDIS_HOST,
      port: Number(process.env.REDIS_PORT),
      password: process.env.REDIS_PASSWORD,
      base: 'skew-protection'
    },

    // Update strategy
    checkForUpdateStrategy: 'sse',

    // Retention
    retentionDays: 30,
    maxNumberOfVersions: 10,

    // Cookie settings
    cookie: {
      name: '__nkpv',
      path: '/',
      sameSite: 'strict',
      secure: true,
      maxAge: 60 * 60 * 24 * 60 // 60 days
    },

    // Debug
    debug: false
  }
})
```

## Platform-Specific Examples

### Vercel

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  skewProtection: {
    checkForUpdateStrategy: 'sse',

    storage: {
      driver: 'vercel-kv',
      url: process.env.KV_REST_API_URL,
      token: process.env.KV_REST_API_TOKEN
    },

    retentionDays: 30,
    maxNumberOfVersions: 10
  }
})
```

### Cloudflare Workers

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  nitro: {
    preset: 'cloudflare-durable',
    experimental: {
      websockets: true
    }
  },

  skewProtection: {
    checkForUpdateStrategy: 'ws',

    storage: {
      driver: 'cloudflare-kv-binding',
      binding: 'SKEW_PROTECTION_KV'
    },

    retentionDays: 30,
    maxNumberOfVersions: 10
  }
})
```

### Netlify

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  nitro: {
    preset: 'netlify'
  },

  skewProtection: {
    checkForUpdateStrategy: 'sse',

    storage: {
      driver: 'redis',
      host: process.env.UPSTASH_REDIS_HOST,
      port: Number(process.env.UPSTASH_REDIS_PORT),
      password: process.env.UPSTASH_REDIS_PASSWORD,
      tls: {}
    },

    retentionDays: 30,
    maxNumberOfVersions: 10
  }
})
```

### Static Hosting

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  ssr: false, // SPA mode

  skewProtection: {
    checkForUpdateStrategy: 'polling',

    storage: {
      driver: 'fs',
      base: '.nuxt/skew-protection'
    },

    retentionDays: 7,
    maxNumberOfVersions: 3
  }
})
```

## Environment-Based Config

```ts [nuxt.config.ts]
const isDev = process.env.NODE_ENV === 'development'
const isProd = process.env.NODE_ENV === 'production'

export default defineNuxtConfig({
  skewProtection: {
    enabled: isProd,

    storage: isDev
      ? {
          driver: 'fs',
          base: 'node_modules/.cache/nuxt/skew-protection'
        }
      : {
          driver: 'redis',
          url: process.env.REDIS_URL
        },

    checkForUpdateStrategy: isDev ? 'polling' : 'sse',

    debug: isDev,

    retentionDays: isDev ? 1 : 30,
    maxNumberOfVersions: isDev ? 2 : 10
  }
})
```

## Runtime Config

Some options can be overridden at runtime:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  runtimeConfig: {
    skewProtection: {
      // Runtime-configurable options
      retentionDays: 30,
      maxNumberOfVersions: 10
    }
  }
})
```

Then override via environment variables:

```bash
NUXT_SKEW_PROTECTION_RETENTION_DAYS=7
NUXT_SKEW_PROTECTION_MAX_NUMBER_OF_VERSIONS=5
```

## Experimental Features

### Custom Build ID

Override the build ID generation:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  app: {
    buildId: () => {
      // Custom build ID logic
      return `v${process.env.APP_VERSION}-${Date.now()}`
    }
  }
})
```

### Polling Interval

When using polling strategy:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  experimental: {
    // Check every 5 minutes
    checkOutdatedBuildInterval: 5 * 60 * 1000
  }
})
```

## Type Definitions

```ts
interface ModuleOptions {
  enabled?: boolean
  storage?: StorageOptions
  checkForUpdateStrategy?: 'polling' | 'sse' | 'ws'
  retentionDays?: number
  maxNumberOfVersions?: number
  cookie?: CookieOptions & {
    name?: string
  }
  debug?: boolean
}

interface StorageOptions {
  driver: string
  [key: string]: any // Driver-specific options
}

interface CookieOptions {
  path?: string
  domain?: string
  maxAge?: number
  expires?: Date
  httpOnly?: boolean
  secure?: boolean
  sameSite?: 'lax' | 'strict' | 'none'
}
```

## See Also

- [Storage Configuration](/docs/skew-protection/guides/storage-configuration) - Storage drivers
- [Update Strategies](/docs/skew-protection/guides/update-strategies) - Detection strategies
- [Platform Guides](/docs/skew-protection/guides/platforms) - Platform-specific setup
