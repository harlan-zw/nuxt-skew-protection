---
title: Nuxt Hooks
description: Hooks for integrating with version updates.
---

Client-side hooks for responding to version updates and module invalidations.

## Available Hooks

### `app:manifest:update`

**Type:** Built-in Nuxt hook

Fired when a new version is detected.

**Payload:**

```ts
interface NuxtAppManifestMeta {
  id: string // New buildId
  timestamp: number
  skewProtection?: {
    current: string
    versions: Record<string, VersionInfo>
  }
}
```

**Usage:**

```ts [plugins/version-update.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.hooks.hook('app:manifest:update', (manifest) => {
    console.log('New version detected:', manifest.id)
    console.log('Build timestamp:', manifest.timestamp)
  })
})
```

### `skew-protection:chunks-outdated`

**Type:** Custom hook

Fired when the user's loaded chunks become outdated by a new deployment.

**Payload:**

```ts
interface ChunksOutdatedPayload {
  deletedChunks: string[]
  invalidatedModules: string[]
  passedReleases: string[]
}
```

**Usage:**

```ts [plugins/track-invalidation.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.hooks.hook('skew-protection:chunks-outdated', (payload) => {
    console.log('Deleted chunks:', payload.deletedChunks)
    console.log('Invalidated modules:', payload.invalidatedModules)
    console.log('Passed releases:', payload.passedReleases)

    // User's session is broken, should reload
  })
})
```

## Examples

### Analytics Tracking

Track version updates and invalidations:

```ts [plugins/analytics.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  // Track version updates
  nuxtApp.hooks.hook('app:manifest:update', (manifest) => {
    analytics.track('version_update_detected', {
      newVersion: manifest.id,
      timestamp: manifest.timestamp
    })
  })

  // Track module invalidations
  nuxtApp.hooks.hook('skew-protection:chunks-outdated', (payload) => {
    analytics.track('chunks_outdated', {
      deletedCount: payload.deletedChunks.length,
      invalidatedCount: payload.invalidatedModules.length,
      passedReleasesCount: payload.passedReleases.length,
      deletedChunks: payload.deletedChunks,
      invalidatedModules: payload.invalidatedModules,
      passedReleases: payload.passedReleases
    })
  })
})
```

### Custom Notification

Show custom notification when modules are invalidated:

```ts [plugins/custom-notification.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.hooks.hook('skew-protection:chunks-outdated', ({ invalidatedModules }) => {
    // Show notification
    const notification = document.createElement('div')
    notification.className = 'update-notification'
    notification.innerHTML = `
      <div class="notification-content">
        <p><strong>Update Required</strong></p>
        <p>${invalidatedModules.length} modules need updating</p>
        <button onclick="window.location.reload()">Reload Now</button>
      </div>
    `
    document.body.appendChild(notification)
  })
})
```

### Auto-Reload on Invalidation

Automatically reload when modules are invalidated:

```ts [plugins/auto-reload.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.hooks.hook('skew-protection:chunks-outdated', () => {
    // Wait 2 seconds then reload
    setTimeout(() => {
      window.location.reload()
    }, 2000)
  })
})
```

### Conditional Reload

Only reload if user is idle:

```ts [plugins/smart-reload.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  let lastActivity = Date.now()

  // Track user activity
  const events = ['mousedown', 'keydown', 'scroll', 'touchstart']
  events.forEach((event) => {
    window.addEventListener(event, () => {
      lastActivity = Date.now()
    })
  })

  nuxtApp.hooks.hook('skew-protection:chunks-outdated', () => {
    const idleTime = Date.now() - lastActivity

    // If idle for 30 seconds, reload immediately
    if (idleTime > 30000) {
      console.log('User idle, reloading...')
      window.location.reload()
    }
    else {
      // Otherwise, show notification
      console.log('User active, showing notification')
      // Show notification logic...
    }
  })
})
```

### Error Reporting

Report version skew to error tracking:

```ts [plugins/error-tracking.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.hooks.hook('app:manifest:update', (manifest) => {
    const { currentVersion } = useSkewProtection()

    if (currentVersion.value !== manifest.id) {
      // Report version skew
      errorTracker.setContext('version', {
        userVersion: currentVersion.value,
        latestVersion: manifest.id,
        skewed: true
      })
    }
  })

  nuxtApp.hooks.hook('skew-protection:chunks-outdated', (payload) => {
    // Report as warning (not error)
    errorTracker.captureMessage('User chunks outdated', {
      level: 'warning',
      extra: {
        deletedChunks: payload.deletedChunks,
        invalidatedModules: payload.invalidatedModules,
        passedReleases: payload.passedReleases
      }
    })
  })
})
```

### Toast Notification

Show toast on version update:

```ts [plugins/toast-notification.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.hooks.hook('skew-protection:chunks-outdated', () => {
    // Using a toast library
    useToast().add({
      title: 'Update Available',
      description: 'A new version is available. Please reload to update.',
      actions: [{
        label: 'Reload',
        onClick: () => window.location.reload()
      }],
      timeout: 0 // Don't auto-dismiss
    })
  })
})
```

### Feature Flag Update

Check for feature flag changes on version update:

```ts [plugins/feature-flags.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.hooks.hook('app:manifest:update', async (manifest) => {
    // Fetch new feature flags
    const newFlags = await $fetch('/api/feature-flags', {
      params: { version: manifest.id }
    })

    // Update feature flags store
    const flagStore = useFeatureFlagStore()
    flagStore.updateFlags(newFlags)

    console.log('Feature flags updated for version:', manifest.id)
  })
})
```

### Countdown Timer

Show countdown before auto-reload:

```ts [plugins/countdown-reload.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.hooks.hook('skew-protection:chunks-outdated', () => {
    let countdown = 10
    let interval: NodeJS.Timeout

    const showCountdown = () => {
      const el = document.createElement('div')
      el.id = 'reload-countdown'
      el.innerHTML = `Reloading in ${countdown}s...`
      document.body.appendChild(el)

      interval = setInterval(() => {
        countdown--
        el.innerHTML = `Reloading in ${countdown}s...`

        if (countdown <= 0) {
          clearInterval(interval)
          window.location.reload()
        }
      }, 1000)
    }

    showCountdown()
  })
})
```

### Debug Logger

Log all skew protection events:

```ts [plugins/debug-logger.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  if (process.env.NODE_ENV !== 'development')
    return

  nuxtApp.hooks.hook('app:manifest:update', (manifest) => {
    console.group('🔄 Version Update')
    console.log('New Version:', manifest.id)
    console.log('Timestamp:', new Date(manifest.timestamp))
    console.log('Manifest:', manifest)
    console.groupEnd()
  })

  nuxtApp.hooks.hook('skew-protection:chunks-outdated', (payload) => {
    console.group('⚠️ Chunks Outdated')
    console.log('Deleted Chunks:', payload.deletedChunks)
    console.log('Invalidated Modules:', payload.invalidatedModules)
    console.log('Passed Releases:', payload.passedReleases)
    console.groupEnd()
  })
})
```

### Save State Before Reload

Save app state before reloading:

```ts [plugins/save-state.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  nuxtApp.hooks.hook('skew-protection:chunks-outdated', () => {
    // Save current route
    const route = useRoute()
    sessionStorage.setItem('pendingReload', 'true')
    sessionStorage.setItem('returnRoute', route.fullPath)

    // Save form data, etc.
    const formStore = useFormStore()
    sessionStorage.setItem('formData', JSON.stringify(formStore.$state))

    // Show notification
    alert('New version available. Your progress will be saved.')

    // Reload
    setTimeout(() => {
      window.location.reload()
    }, 1000)
  })
})
```

### Version History

Track version history:

```ts [plugins/version-history.client.ts]
export default defineNuxtPlugin((nuxtApp) => {
  const versionHistory = useLocalStorage<string[]>('version-history', [])

  nuxtApp.hooks.hook('app:manifest:update', (manifest) => {
    if (!versionHistory.value.includes(manifest.id)) {
      versionHistory.value.push(manifest.id)

      // Keep only last 10 versions
      if (versionHistory.value.length > 10) {
        versionHistory.value.shift()
      }
    }
  })
})
```

## Hook Order

Hooks fire in this order when a new version is detected:

1. `app:manifest:update` - New version detected
2. Service worker checks loaded modules
3. `skew-protection:chunks-outdated` - Only if chunks are outdated

## Notes

- `app:manifest:update` fires for **any** version update
- `skew-protection:chunks-outdated` only fires when user's **loaded chunks** are deleted
- Both hooks are client-side only
- Hooks fire regardless of the [update strategy](/docs/skew-protection/guides/update-strategies) used
- `passedReleases` contains all release IDs between the user's version and the latest version

## See Also

- [useSkewProtection](/docs/skew-protection/api/use-skew-protection) - Composable API
- [How it Works](/docs/skew-protection/guides/how-it-works) - Module invalidation logic
- [Update Strategies](/docs/skew-protection/guides/update-strategies) - Detection strategies
