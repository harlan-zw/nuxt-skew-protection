---
title: useSkewProtection
description: Composable for accessing skew protection state and methods.
---

The main composable for interacting with Nuxt Skew Protection.

## Usage

```ts
const skew = useSkewProtection()
```

## Returns

### `manifest`

- Type: `Ref<NuxtAppManifestMeta | null>`

The current build manifest from `builds/latest.json`.

```ts
const { manifest } = useSkewProtection()

console.log(manifest.value?.id) // Current buildId
console.log(manifest.value?.timestamp) // Build timestamp
```

### `currentVersion`

- Type: `Ref<string>`

The user's current version (from cookie or buildId).

```ts
const { currentVersion } = useSkewProtection()

console.log(currentVersion.value) // "abc123"
```

### `latestVersion`

- Type: `ComputedRef<string | null>`

The latest deployed version from the manifest.

```ts
const { latestVersion } = useSkewProtection()

console.log(latestVersion.value) // "def456"
```

### `isOutdated`

- Type: `ComputedRef<boolean>`

Whether the user's version is outdated.

```ts
const { isOutdated } = useSkewProtection()

if (isOutdated.value) {
  console.log('User is on an old version')
}
```

### `checkForUpdates()`

- Type: `() => Promise<void>`

Manually trigger an update check.

```ts
const { checkForUpdates } = useSkewProtection()

// Check for updates
await checkForUpdates()
```

### `onChunksOutdated()`

- Type: `(callback: (payload: ChunksOutdatedPayload) => void) => void`

Register a callback for when loaded chunks become outdated.

```ts
const { onChunksOutdated } = useSkewProtection()

onChunksOutdated((payload) => {
  console.log('Deleted chunks:', payload.deletedChunks)
  console.log('Invalidated modules:', payload.invalidatedModules)
  console.log('Passed releases:', payload.passedReleases)

  // Show notification
  alert('Please reload to get the latest version')
})
```

## Type Definitions

```ts
interface NuxtAppManifestMeta {
  id: string
  timestamp: number
  skewProtection?: {
    current: string
    versions: Record<string, VersionInfo>
  }
}

interface VersionInfo {
  timestamp: string
  expires: string
  assets: string[]
  deletedChunks?: string[]
}

interface ChunksOutdatedPayload {
  deletedChunks: string[]
  invalidatedModules: string[]
  passedReleases: string[]
}
```

## Examples

### Show Update Notification

```vue
<script setup>
const { isOutdated, checkForUpdates } = useSkewProtection()

// Check for updates every 5 minutes
useIntervalFn(checkForUpdates, 5 * 60 * 1000)
</script>

<template>
  <div v-if="isOutdated" class="update-banner">
    A new version is available!
    <button @click="() => window.location.reload()">
      Reload
    </button>
  </div>
</template>
```

### Custom Invalidation Handler

```ts
const { onChunksOutdated } = useSkewProtection()

onChunksOutdated(({ invalidatedModules, passedReleases }) => {
  // Track in analytics
  analytics.track('chunks_outdated', {
    count: invalidatedModules.length,
    modules: invalidatedModules,
    releases: passedReleases
  })

  // Show custom UI
  showUpdateDialog({
    title: 'Update Required',
    message: `${invalidatedModules.length} modules need updating (${passedReleases.length} releases passed)`
  })
})
```

### Version Information Display

```vue
<script setup>
const { currentVersion, latestVersion, manifest } = useSkewProtection()

const buildDate = computed(() => {
  if (!manifest.value?.timestamp)
    return null
  return new Date(manifest.value.timestamp).toLocaleString()
})
</script>

<template>
  <div class="version-info">
    <p>Your version: {{ currentVersion }}</p>
    <p>Latest version: {{ latestVersion }}</p>
    <p>Build date: {{ buildDate }}</p>
  </div>
</template>
```

### Programmatic Update Check

```ts
const { checkForUpdates, isOutdated } = useSkewProtection()

async function handleUserAction() {
  // Check for updates before critical action
  await checkForUpdates()

  if (isOutdated.value) {
    const shouldReload = confirm('A new version is available. Reload now?')
    if (shouldReload) {
      window.location.reload()
    }
  }
  else {
    // Proceed with action
    await performCriticalAction()
  }
}
```

### Watch for Version Changes

```ts
const { manifest, currentVersion } = useSkewProtection()

watch(manifest, (newManifest) => {
  if (newManifest && newManifest.id !== currentVersion.value) {
    console.log('New version detected:', newManifest.id)
  }
})
```

## Notes

- The composable is available in both client and server contexts
- `onChunksOutdated` only works on the client (requires service worker)
- Automatic update checks are handled by the configured [update strategy](/docs/skew-protection/guides/update-strategies)
- Manual `checkForUpdates()` is useful for testing or custom logic
- `passedReleases` contains all release IDs between the user's version and the latest version

## See Also

- [useSkewProtectionCookie](/docs/skew-protection/api/use-skew-protection-cookie) - Access the version cookie
- [SkewNotification](/docs/skew-protection/api/skew-notification) - Ready-made notification component
- [Update Strategies](/docs/skew-protection/guides/update-strategies) - Configure automatic checks
