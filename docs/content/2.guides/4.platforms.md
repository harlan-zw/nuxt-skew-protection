---
title: Platform Guides
description: Platform-specific setup and configuration for Nuxt Skew Protection.
---

Platform-specific configuration guides for deploying Nuxt Skew Protection.

## Vercel

Vercel has [native skew protection](https://vercel.com/docs/deployments/skew-protection). This module integrates with it while providing additional features.

### Setup

1. **Enable Vercel's native protection:**

   ```bash [.env]
   VERCEL_SKEW_PROTECTION_ENABLED=1
   ```

2. **Configure storage (Vercel KV):**

   ```bash
   npm install @vercel/kv
   ```

   ```ts [nuxt.config.ts]
   export default defineNuxtConfig({
     skewProtection: {
       storage: {
         driver: 'vercel-kv',
         // Auto-configured from environment
         url: process.env.KV_REST_API_URL,
         token: process.env.KV_REST_API_TOKEN
       }
     }
   })
   ```

3. **Create KV Store:**
   - Vercel Dashboard → Storage → Create KV Store
   - Link to your project
   - Environment variables are automatically set

### What Happens

- **Vercel's protection:** Sets `__vdpl` cookie for deployment targeting
- **This module:** Sets `__nkpv` cookie for version tracking
- **Both work together** to provide comprehensive skew protection

### Configuration

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  skewProtection: {
    // SSE is default for Vercel
    checkForUpdateStrategy: 'sse',

    storage: {
      driver: 'vercel-kv'
    },

    // Retention
    retentionDays: 30,
    maxNumberOfVersions: 10
  }
})
```

### Deployment

```bash
# Build and deploy
vercel
```

The module automatically detects Vercel and configures accordingly.

---

## Cloudflare Workers & Pages

Cloudflare Workers require special configuration for WebSocket support.

### Workers (with Durable Objects)

1. **Install Wrangler:**

   ```bash
   npm install -D wrangler
   ```

2. **Configure Nitro:**

   ```ts [nuxt.config.ts]
   export default defineNuxtConfig({
     nitro: {
       preset: 'cloudflare-durable',
       experimental: {
         websockets: true
       }
     },

     skewProtection: {
       checkForUpdateStrategy: 'ws',

       // Cloudflare KV storage
       storage: {
         driver: 'cloudflare-kv-binding',
         namespaceId: process.env.CLOUDFLARE_KV_NAMESPACE_ID // Auto-detected from wrangler.toml if omitted
       }
     }
   })
   ```

3. **Create KV namespace:**

   ```bash
   wrangler kv:namespace create "SKEW_PROTECTION"
   ```

4. **Configure Wrangler:**

   ```toml [wrangler.toml]
   name = "my-nuxt-app"
   compatibility_flags = [ "nodejs_compat" ]

   [[kv_namespaces]]
   binding = "SKEW_PROTECTION"
   id = "your-kv-namespace-id" # From step 3
   ```

5. **Deploy:**

   ```bash
   npm run build  # Uses wrangler CLI to access KV during build
   wrangler deploy
   ```

::alert{type="info"}
The module automatically uses wrangler CLI commands to access Cloudflare KV during build. No API token needed - it leverages your existing wrangler authentication!
::

### Pages (Static + Functions)

For Cloudflare Pages without Durable Objects:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  nitro: {
    preset: 'cloudflare-pages'
  },

  skewProtection: {
    // Use polling instead of WebSocket
    checkForUpdateStrategy: 'polling',

    // Cloudflare KV storage
    storage: {
      driver: 'cloudflare-kv-binding',
      namespaceId: process.env.CLOUDFLARE_KV_NAMESPACE_ID // Auto-detected from wrangler.toml if omitted
    }
  }
})
```

Follow the same setup steps as Workers above to create KV namespace.

### Cloudflare R2 (Alternative Storage)

For larger storage needs:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  skewProtection: {
    storage: {
      driver: 's3',
      endpoint: `https://${process.env.CF_ACCOUNT_ID}.r2.cloudflarestorage.com`,
      region: 'auto',
      bucket: 'skew-protection',
      accessKeyId: process.env.R2_ACCESS_KEY_ID,
      secretAccessKey: process.env.R2_SECRET_ACCESS_KEY
    }
  }
})
```

---

## Netlify

Netlify supports both static and SSR deployments.

### Setup

1. **Configure for Netlify:**

   ```ts [nuxt.config.ts]
   export default defineNuxtConfig({
     nitro: {
       preset: 'netlify'
     },

     skewProtection: {
       // SSE works on Netlify Functions
       checkForUpdateStrategy: 'sse',

       // Use external storage (Upstash Redis recommended)
       storage: {
         driver: 'redis',
         host: process.env.UPSTASH_REDIS_HOST,
         port: Number(process.env.UPSTASH_REDIS_PORT),
         password: process.env.UPSTASH_REDIS_PASSWORD,
         tls: {}
       }
     }
   })
   ```

2. **Set environment variables:**

   ```bash
   # Netlify UI: Site settings → Environment variables
   UPSTASH_REDIS_HOST=your-host.upstash.io
   UPSTASH_REDIS_PORT=6379
   UPSTASH_REDIS_PASSWORD=your-password
   ```

3. **Deploy:**

   ```bash
   npm run build
   netlify deploy --prod
   ```

### Static Sites

For static generation on Netlify:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  nitro: {
    preset: 'netlify',
    prerender: {
      routes: ['/'] // Add routes to prerender
    }
  },

  skewProtection: {
    // Must use polling for static
    checkForUpdateStrategy: 'polling',

    // Filesystem storage (included in build)
    storage: {
      driver: 'fs',
      base: '.netlify/cache/skew-protection'
    }
  }
})
```

---

## AWS (EC2, ECS, Fargate)

### EC2 / ECS

1. **Configure storage (ElastiCache Redis):**

   ```ts [nuxt.config.ts]
   export default defineNuxtConfig({
     skewProtection: {
       checkForUpdateStrategy: 'sse',

       storage: {
         driver: 'redis',
         host: process.env.REDIS_ENDPOINT,
         port: 6379
       }
     }
   })
   ```

2. **Or use S3:**

   ```ts [nuxt.config.ts]
   export default defineNuxtConfig({
     skewProtection: {
       storage: {
         driver: 's3',
         bucket: process.env.S3_BUCKET,
         region: process.env.AWS_REGION,
         accessKeyId: process.env.AWS_ACCESS_KEY_ID,
         secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY
       }
     }
   })
   ```

3. **IAM Permissions for S3:**

   ```json
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": [
           "s3:GetObject",
           "s3:PutObject",
           "s3:DeleteObject",
           "s3:ListBucket"
         ],
         "Resource": [
           "arn:aws:s3:::your-bucket/*",
           "arn:aws:s3:::your-bucket"
         ]
       }
     ]
   }
   ```

---

## Railway

Railway supports both ephemeral and persistent storage.

### Setup

1. **Add Redis addon:**

   ```bash
   # Railway dashboard → Add Redis
   ```

2. **Configure:**

   ```ts [nuxt.config.ts]
   export default defineNuxtConfig({
     skewProtection: {
       checkForUpdateStrategy: 'sse',

       storage: {
         driver: 'redis',
         // Railway auto-sets REDIS_URL
         url: process.env.REDIS_URL
       }
     }
   })
   ```

3. **Deploy:**

   ```bash
   # Connect to Railway
   railway link

   # Deploy
   railway up
   ```

---

## Fly.io

Fly.io supports persistent volumes and external storage.

### With Upstash Redis

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  skewProtection: {
    checkForUpdateStrategy: 'sse',

    storage: {
      driver: 'redis',
      host: process.env.UPSTASH_REDIS_HOST,
      port: Number(process.env.UPSTASH_REDIS_PORT),
      password: process.env.UPSTASH_REDIS_PASSWORD,
      tls: {}
    }
  }
})
```

### With Tigris (S3-compatible)

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  skewProtection: {
    storage: {
      driver: 's3',
      endpoint: process.env.TIGRIS_ENDPOINT,
      region: 'auto',
      bucket: 'skew-protection',
      accessKeyId: process.env.TIGRIS_ACCESS_KEY_ID,
      secretAccessKey: process.env.TIGRIS_SECRET_ACCESS_KEY
    }
  }
})
```

---

## Heroku

Heroku requires external storage (ephemeral filesystem).

### Setup

1. **Add Redis addon:**

   ```bash
   heroku addons:create heroku-redis:mini
   ```

2. **Configure:**

   ```ts [nuxt.config.ts]
   export default defineNuxtConfig({
     skewProtection: {
       checkForUpdateStrategy: 'sse',

       storage: {
         driver: 'redis',
         // Heroku sets REDIS_URL automatically
         url: process.env.REDIS_URL,
         tls: {
           rejectUnauthorized: false
         }
       }
     }
   })
   ```

3. **Deploy:**

   ```bash
   git push heroku main
   ```

---

## Static Hosting (GitHub Pages, Surge, etc.)

For static sites without server functions:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  ssr: false, // SPA mode

  skewProtection: {
    // Must use polling
    checkForUpdateStrategy: 'polling',

    // Assets included in build
    storage: {
      driver: 'fs',
      base: '.nuxt/skew-protection'
    },

    // Shorter retention for static sites
    retentionDays: 7,
    maxNumberOfVersions: 3
  }
})
```

### Limitations

- ⚠️ No real-time updates (polling only)
- ⚠️ Assets bundled in deployment (larger size)
- ⚠️ Limited version retention

---

## Self-Hosted (Node.js)

Full flexibility with self-hosting.

### Development Setup

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  skewProtection: {
    checkForUpdateStrategy: 'sse',

    storage: {
      driver: 'fs',
      base: '.data/skew-protection'
    }
  }
})
```

### Production Setup

1. **With Docker:**

   ```dockerfile
   FROM node:20-alpine
   WORKDIR /app

   # Copy app
   COPY package*.json ./
   RUN npm ci --production
   COPY . .

   # Create persistent volume for storage
   VOLUME ["/app/.data"]

   # Build
   RUN npm run build

   # Start
   CMD ["node", ".output/server/index.mjs"]
   ```

2. **Docker Compose with Redis:**

   ```yaml [docker-compose.yml]
   version: '3.8'
   services:
     app:
       build: .
       ports:
         - '3000:3000'
       environment:
         - REDIS_HOST=redis
       depends_on:
         - redis

     redis:
       image: redis:7-alpine
       volumes:
         - redis-data:/data

   volumes:
     redis-data:
   ```

3. **Configure Redis:**

   ```ts [nuxt.config.ts]
   export default defineNuxtConfig({
     skewProtection: {
       storage: {
         driver: 'redis',
         host: process.env.REDIS_HOST || 'localhost',
         port: 6379
       }
     }
   })
   ```

---

## Platform Comparison

| Platform | Strategy | Storage | Difficulty | Real-time |
|----------|----------|---------|------------|-----------|
| **Vercel** | SSE | Vercel KV | ⭐ Easy | ✅ Yes |
| **Cloudflare Workers** | WS | Cloudflare KV | ⭐⭐ Medium | ✅ Yes |
| **Netlify** | SSE | Upstash Redis | ⭐⭐ Medium | ✅ Yes |
| **AWS EC2/ECS** | SSE | ElastiCache/S3 | ⭐⭐⭐ Advanced | ✅ Yes |
| **Railway** | SSE | Railway Redis | ⭐ Easy | ✅ Yes |
| **Fly.io** | SSE | Upstash/Tigris | ⭐⭐ Medium | ✅ Yes |
| **Heroku** | SSE | Heroku Redis | ⭐⭐ Medium | ✅ Yes |
| **Static** | Polling | Filesystem | ⭐ Easy | ❌ No |
| **Self-hosted** | SSE | Filesystem/Redis | ⭐⭐ Medium | ✅ Yes |

---

## Next Steps

- [Storage Configuration](/docs/skew-protection/guides/storage-configuration) - Detailed storage setup
- [Update Strategies](/docs/skew-protection/guides/update-strategies) - Choose update detection method
- [Troubleshooting](/docs/skew-protection/getting-started/troubleshooting) - Common platform issues
